#!/bin/bash

# Array of Kafka broker addresses
kafkaBrokers=("kafka-broker-0.kafka-broker-headless.default.svc.cluster.local:9092" "kafka-broker-1.kafka-broker-headless.default.svc.cluster.local:9092" "kafka-broker-2.kafka-broker-headless.default.svc.cluster.local:9092")

# Function to check Kafka broker connectivity
check_kafka() {
  for broker in "${kafkaBrokers[@]}"; do
    if /opt/kafka_2.13-3.4.0/bin/kafka-topics.sh --bootstrap-server "$broker" --list > /dev/null 2>&1; then
      echo "Kafka broker $broker is reachable"
      return 0
    fi
  done
  echo "No Kafka brokers are reachable"
  return 1
}

# Function to check PostgreSQL connectivity
check_postgres() {
  pg_isready -d $DB_URL > /dev/null 2>&1
  if [ $? -eq 0 ]; then
    echo "PostgreSQL is reachable"
    return 0
  else
    echo "PostgreSQL is not reachable"
    return 1
  fi
}

# Check both Kafka and PostgreSQL
check_kafka && check_postgres
